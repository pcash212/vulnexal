<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forgot Password - Vulnexal</title>

    
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />

    
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.0/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />

    
    <link href="style.css" rel="stylesheet" />
  </head>
  <body>
    
    <div id="forgot-password-page" class="page-container active">
      <header class="login-header">
        <div
          class="container-fluid h-100 d-flex align-items-center justify-content-between px-4"
        >
          <div class="logo-section d-flex align-items-center gap-2">
            <i class="bi bi-shield-check text-success fs-3"></i>
            <h1 class="h4 mb-0 text-dark fw-bold" style="font-family: 'Arial Black', sans-serif; letter-spacing: 1px;">Vulnexal</h1>
          </div>
        </div>
      </header>

      <main class="login-main">
        <div class="login-container">
          
          <div class="login-card card border-0 shadow-lg animate-fade-in">
            <div class="card-body p-5 text-center">
              
              <div class="circular-logo-wrapper mb-4 animate-slide-up">
                <div class="circular-logo">
                  <i class="bi bi-shield-check"></i>
                </div>
              </div>
              <h2 class="card-title h3 fw-bold mb-2">Reset Password</h2>
              <p class="text-muted mb-5">
                Enter your email address and we'll send you a link to reset your
                password
              </p>

              
              <div
                id="forgotError"
                class="alert alert-danger d-none"
                role="alert"
              >
                <i class="bi bi-exclamation-triangle me-2"></i>
                <span id="forgotErrorText"></span>
              </div>

              
              <div
                id="forgotSuccess"
                class="alert alert-success d-none"
                role="alert"
              >
                <i class="bi bi-check-circle me-2"></i>
                <span id="forgotSuccessText"></span>
              </div>

              
              <form
                id="forgot-password-form"
                class="login-form"
                onsubmit="return false;"
              >
                
                <div class="mb-4 text-start form-group-animated">
                  <label for="forgot-email" class="form-label fw-normal mb-2"
                    >Email Address</label
                  >
                  <div class="input-group input-group-lg">
                    <span class="input-group-text bg-white border-end-0">
                      <i class="bi bi-envelope text-muted"></i>
                    </span>
                    <input
                      type="email"
                      class="form-control border-start-0 ps-0"
                      id="forgot-email"
                      placeholder="Enter your registered email"
                      required
                    />
                  </div>
                </div>

                
                <button
                  type="submit"
                  class="btn btn-success btn-lg w-100 fw-bold mb-4 btn-hover-lift"
                >
                  Send Reset Link
                </button>

                
                <p class="text-muted mb-0">
                  Remember your password?
                  <a
                    href="login.html"
                    class="text-success text-decoration-none fw-bold hover-underline"
                  >
                    Back to Login
                  </a>
                </p>
                
                
                <button type="button" class="btn btn-sm btn-outline-secondary mt-3" onclick="testFirebase()">
                  ðŸ”§ Test Firebase Connection
                </button>
              </form>
            </div>
          </div>
        </div>
      </main>
    </div>

    
    <div id="process-loading-overlay" class="process-loading-overlay">
      <div class="spinner-container">
        <div class="shield-spinner">
          <i class="bi bi-shield-check"></i>
        </div>
        <p class="process-loading-text mt-3">Sending reset link...</p>
        <p class="process-loading-subtext">Please wait</p>
      </div>
    </div>

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    
    <script src="validation.js"></script>
    
    
    <script src="modal.js"></script>

    
    <script>
      console.log("Forgot password script loaded!");
      
      let retryCount = 0;
      const maxRetries = 50;
      
      function initializeApp() {
        if (typeof firebase === 'undefined') {
          retryCount++;
          if (retryCount >= maxRetries) {
            console.error("Firebase failed to load!");
            alert("Error: Firebase SDK failed to load. Please refresh the page.");
            return;
          }
          console.log("Firebase not loaded yet, retrying... (" + retryCount + "/" + maxRetries + ")");
          setTimeout(initializeApp, 100);
          return;
        }
        
        console.log("Firebase is loaded!");
        const firebaseConfig = {
          apiKey: "AIzaSyBJ3XdoHatJhGOKFcnoAYMTqPGYW3Jymk4",
          authDomain: "web-vulnerability-scanne-f066b.firebaseapp.com",
          projectId: "web-vulnerability-scanne-f066b",
          storageBucket: "web-vulnerability-scanne-f066b.appspot.com",
          messagingSenderId: "875094369190",
          appId: "1:875094369190:web:276df6ce835be8b3672567",
          measurementId: "G-HFS9XCX60H"
        };

        let app;
        try {
          app = firebase.initializeApp(firebaseConfig);
        } catch (error) {
          app = firebase.app();
        }
        
        const auth = firebase.auth();
        
        const forgotForm = document.getElementById("forgot-password-form");
        if (forgotForm) {
          setupRealtimeValidation(document.getElementById("forgot-email"), Validator.validateEmail);
          
          forgotForm.addEventListener("submit", async function(e) {
            e.preventDefault();

            const email = document.getElementById("forgot-email").value.trim();
            const errorDiv = document.getElementById("forgotError");
            const successDiv = document.getElementById("forgotSuccess");
            const errorText = document.getElementById("forgotErrorText");
            const successText = document.getElementById("forgotSuccessText");

            if (errorDiv) errorDiv.classList.add("d-none");
            if (successDiv) successDiv.classList.add("d-none");

            const emailCheck = Validator.validateEmail(email);
            if (!emailCheck.valid) {
              if (errorText) errorText.textContent = emailCheck.message;
              if (errorDiv) errorDiv.classList.remove("d-none");
              return;
            }

            const overlay = document.getElementById("process-loading-overlay");
            if (overlay) overlay.classList.add("active");

            try {
              console.log("=== PASSWORD RESET DEBUG ===");
              console.log("Firebase Auth Object:", auth);
              console.log("Attempting to send to:", email);
              console.log("Firebase initialized:", !!firebase);
              console.log("Auth initialized:", !!auth);
              
              const result = await auth.sendPasswordResetEmail(email);
              console.log("sendPasswordResetEmail result:", result);
              
              if (overlay) overlay.classList.remove("active");
              
              if (successText) {
                successText.innerHTML = "Password reset link has been sent to <strong>" + email + "</strong>. Please check your inbox.";
              }
              if (successDiv) successDiv.classList.remove("d-none");

              console.log("âœ… Password reset email sent successfully to:", email);

              forgotForm.reset();
              setTimeout(() => {
                window.location.href = "login.html";
              }, 2000);

            } catch (error) {
              if (overlay) overlay.classList.remove("active");
              
              console.error("=== PASSWORD RESET ERROR ===");
              console.error("Error Code:", error.code);
              console.error("Error Message:", error.message);
              console.error("Full Error:", error);
              
              let errorMessage = "If an account exists with this email, a password reset link has been sent.";
              
              if (error.code === 'auth/invalid-email') {
                errorMessage = "Please enter a valid email address";
              } else if (error.code === 'auth/too-many-requests') {
                errorMessage = "Too many requests. Please try again later";
              }
              
              if (successText) successText.textContent = errorMessage;
              if (successDiv) successDiv.classList.remove("d-none");
            }
          });
        }
        
        window.testFirebase = function() {
          console.log("=== FIREBASE CONNECTION TEST ===");
          console.log("Firebase object exists:", typeof firebase !== 'undefined');
          console.log("Auth object exists:", typeof auth !== 'undefined');
          console.log("Current user:", auth?.currentUser);
          
          if (auth) {
            console.log("âœ… Firebase Auth is properly initialized");
            console.log("Auth config:", auth.app.options);
            alert("âœ… Firebase is connected!\n\nNow try entering your email and clicking 'Send Reset Link'.\n\nWatch the console (F12) for detailed logs.");
          } else {
            console.error("âŒ Firebase Auth is NOT initialized");
            alert("âŒ Firebase is NOT connected! Check console for errors.");
          }
        };

        // Enable Enter key to submit form
        const forgotEmailInput = document.getElementById("forgot-email");
        
        const handleForgotEnterKey = (event) => {
          if (event.key === 'Enter' || event.keyCode === 13) {
            event.preventDefault();
            const form = document.getElementById("forgot-password-form");
            const submitButton = form?.querySelector('button[type="submit"]');
            if (submitButton) {
              submitButton.click();
            }
          }
        };
        
        if (forgotEmailInput) {
          forgotEmailInput.addEventListener('keypress', handleForgotEnterKey);
        }
      } // End of initializeApp
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeApp);
      } else {
        initializeApp();
      }
    </script>
  </body>
</html>
